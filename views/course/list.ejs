<script>
    $(document).ready(() => {
        const table = $('#table').DataTable({
            ordering: true,
            searching: true,
            paging: true,
            ajax: '/api/course',
            columns: [
            { title: 'Course Name', data: 'name' },
            { title: 'Teacher', data: 'teacher.name' },
            { 
                title: 'Start Date', 
                data: 'startDate',
                render: function (data, type, row, meta) {
                    return moment(data).format('DD/MM/YYYY');
                }
            },
            { 
                title: 'End Date', 
                data: 'endDate',
                render: function (data, type, row, meta) {
                    return moment(data).format('DD/MM/YYYY');
                }
            },
            { 
                title: 'Students', 
                data: 'students',
                render: function (data, type, row, meta) {
                    assignedStd = row.students.length.toString()
                    maxStd = row.maxStudents.toString()
                    data = assignedStd + '/' + maxStd;
                    return data
                },
            },
            {
                title: 'Detail',
                data: '_id',
                render: function (data, type, row, meta) {
                return `<a href="/course/detail/${data}" class="btn btn-outline-secondary btn-sm" >Link</a>`;
                },
            },
            { 
                title: 'Action', 
                data: '_id',
                render: function (data, type, row, meta) {
                    return `
                        <a href="/course/edit/${data}" class="btn btn-secondary btn-sm">Edit</a>
                        <button class="btn btn-danger btn-sm delete-course" data-id="${data}">Delete</button>
                        `;
                },
            },
            ],
        })

        $(document).on('click', '.delete-course', event => {
            if (confirm('Are you sure you want to delete this course?')) {
                const courseId = $(event.target).data('id')
                console.log(courseId)
                $.ajax({
                    url: `/api/course/${courseId}`,
                    method: 'DELETE',
                    success: response => {
                        if (response.success) {
                            location.reload()
                        } else {
                            alert('An error occurred: ' + response.message)
                        }
                    },
                    error: (xhr, status, error) => {
                        console.error('Error:', error)
                        alert('An error occurred. Please try again.')
                    },
                })
            }
        })
    })
</script>
<div class="container mt-4">
    <h2>Courses</h2>
    <a href="/course/add" class="btn btn-primary mb-3 admin hide">Add New Course</a>
    <table id="table" class="table table-striped table-bordered" ></table>
</div>
<%- contentFor('title') %>Course
