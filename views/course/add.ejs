<div class="container mt-4">
    <h1>Add New Course</h1>
    <form id="addCourseForm">
        <div class="form-group">
            <label for="course_name">Course Name:</label>
            <input
                type="text"
                class="form-control"
                id="course_name"
                name="name"
                required
            />
        </div>
        <div class="form-group">
            <label for="description">Description:</label>
            <textarea
                class="form-control"
                id="description"
                name="description"
                rows="3"
            ></textarea>
        </div>
        <div class="form-group">
            <label for="teacher">Teacher:</label>
            <select class="form-control" id="teacher" name="teacher" required>
                <template id="teacherOption">
                    <option value="${value}">${text}</option>
                </template>
            </select>
        </div>
        <div class="form-group">
            <label for="startDate">Start Date:</label>
            <input
                type="text"
                class="form-control"
                id="startDate"
                name="startDate"
                required
            />
        </div>
        <div class="form-group">
            <label for="endDate">End Date:</label>
            <input
                type="text"
                class="form-control"
                id="endDate"
                name="endDate"
                required
            />
        </div>
        <div class="form-group">
            <label for="maxStudents">Max Students:</label>
            <input
                type="number"
                class="form-control"
                id="maxStudents"
                name="maxStudents"
                required
            />
        </div>
        <div class="form-group">
            <label for="excludeDates">Exclude Specific Dates:</label>
            <input
                type="text"
                class="form-control"
                id="excludeDates"
                name="excludeDates"
                placeholder="Select dates"
            />
        </div>
        <div class="form-group">
            <label for="students">Assign Students:</label>
            <select multiple class="form-control" id="students" name="students">
                <template id="studentOption">
                    <option value="${value}">${text}</option>
                </template>
            </select>
        </div>
        <button type="submit" class="btn btn-primary">Add Course</button>
    </form>
</div>
<script>
    $(document).ready(() => {
        $('#excludeDates').flatpickr({
            mode: 'multiple',
            dateFormat: 'Y-m-d',
        })

        $('#startDate').flatpickr({
            dateFormat: 'Y-m-d',
        })

        $('#endDate').flatpickr({
            dateFormat: 'Y-m-d',
        })

        $('#students').select2()

        $.ajax({
            url: '/api/course/option',
            method: 'GET',
            success: response => {
                console.log('response', response)
                if (!response.success) return
                const { teachers, students } = response.data
                teachers.forEach(teacher => {
                    $.cloneTemplate('#teacherOption', {
                        text: teacher.name,
                        value: teacher._id
                    })
                })
                students.forEach(student => {
                    $.cloneTemplate('#studentOption', {
                        text: student.name,
                        value: student._id
                    })
                })
            },
        })

        $('#addCourseForm').on('submit', event => {
            event.preventDefault()
            const data = $.getFormData('#addCourseForm')
            $.ajax({
                url: '/api/course/add',
                method: 'POST',
                data,
                success: response => {
                    console.log('response', response)
                    if (response.success) {
                        window.location.href = '/course'
                    } else {
                        alert(`An error occurred: ${response.message}`)
                    }
                },
            })
        })
    })
</script>
<%- contentFor('title') %>Add Course
