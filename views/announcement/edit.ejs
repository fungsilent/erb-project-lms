<div class="container mt-4">
    <h1>Edit Announcement</h1>
    <form id="editAnnouncementForm">
        <div class="form-group">
            <label for="content">Content:</label>
            <textarea
                class="form-control"
                name="content"
                rows="3"
            ></textarea>
        </div>
        <div class="form-group">
            <label for="teacher">To:</label>
            <select class="form-control" name="to" required>
                <option value="all">All</option>
                <option value="teacher">Teacher</option>
                <option value="student">Student</option>
            </select>
        </div>
        <div class="form-group">
            <label for="date">Date:</label>
            <input type="text" class="form-control" name="date" disabled>
        </div>
        <button type="submit" class="btn btn-primary">Edit</button>
        <button type="button" class="btn btn-danger delete" data-id="${_id}">Delete</button>
    </form>
</div>

<script>
    $(document).ready(() => {
        const { id } = $.getUrlParameter('/announcement/edit/:id')

        $.ajax({
            url: `/api/announcement/${id}`,
            method: 'GET',
            success: response => {
                if (!response.success) return
                const announcement = response.data
                $.setFormData('#editAnnouncementForm', {
                    ...announcement,
                    date: moment(announcement.date).format('MM-DD-YYYY h:mm'),
                    to: _.findKey(announcement.to, b => b),
                })
            }
        })

        $('#editAnnouncementForm').on('submit', event => {
            event.preventDefault()
            const data = $.getFormData('#editAnnouncementForm')
            $.ajax({
                url: `/api/announcement/${id}`,
                method: 'PUT',
                data,
                success: response => {
                    console.log('response', response)
                    if (!response.success) {
                        return alert(`An error occurred: ${response.message}`)
                    }
                    const announcement = response.data
                    $.setFormData('#editAnnouncementForm', {
                        ...announcement,
                    })
                    window.location.href = '/announcement'
                },
                error: (xhr, status, error) => {
                    console.error('Error:', error);
                    alert('An error occurred. Please try again.');
                }
            })
        })

        $('.delete').click(event => {
            if (confirm('Are you sure you want to delete this announcement?')) {
                $.ajax({
                    url: `/api/announcement/${id}`,
                    method: 'DELETE',
                    success: response => {
                        console.log('response', response)
                        if (!response.success) {
                            return alert(`An error occurred: ${response.message}`)
                        }
                        window.location.href = '/announcement'
                    },
                    error: (xhr, status, error) => {
                        console.error('Error:', error);
                        alert('An error occurred. Please try again.')
                    }
                })
            }
        })
    })

</script>