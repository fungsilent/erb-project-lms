<div id="announcement" class="container mt-4">
    <h2>Announcement</h2>
    <a href="/announcement/add" class="btn btn-primary mb-3 admin hide">Add Announcement</a>
    <table class="table table-striped table-bordered">
        <thead>
            <tr>
                <th>Date</th>
                <th>To</th>
                <th>Content</th>
                <th class="admin hide">Actions</th>
            </tr>
        </thead>
        <tbody>
            <template id="announcementItem">
                <tr>
                    <td>${date}</td>
                    <td>${to}</td>
                    <td>${content}</td>
                    <td>
                        <a
                            href="/announcement/edit/${id}"
                            class="btn btn-secondary btn-sm"
                        >Edit</a>
                        <button
                            class="btn btn-danger btn-sm delete-course"
                            data-id="${id}"
                        >
                            Delete
                        </button>
                    </td>
                </tr>
            </template>
        </tbody>
    </table>
</div>

<script>
    $(document).ready(() => {
        $.ajax({
            url: '/api/announcement',
            method: 'GET',
            success: response => {
                console.log('response', response)
                if (!response.success) return
                response.data.forEach(announcement => {
                    $.cloneTemplate('#announcementItem', {
                        id: announcement._id,
                        content: announcement.content,
                        date: moment(announcement.date).format('MM-DD-YYYY h:mm'),
                        to: _.findKey(announcement.to, b => b),
                    })
                })
            },
        })

        $(document).on('click', '.delete', event => {
            if (confirm('Are you sure you want to delete this announcement?')) {
                const id = $(event.target).data('id')
                $.ajax({
                    url: `/api/announcement/${id}`,
                    method: 'DELETE',
                    success: response => {
                        console.log('response', response)
                        if (!response.success) {
                            return alert(`An error occurred: ${response.message}`)
                        }
                        window.location.href = '/announcement'
                    },
                    error: (xhr, status, error) => {
                        console.error('Error:', error);
                        alert('An error occurred. Please try again.')
                    }
                })
            }
        })
    })
</script>