<script>
    $(document).ready(() => {
        const table = $('#table').DataTable({
            ordering: true,
            searching: true,
            paging: true,
            ajax: '/api/assignments',
            columns: [
            { title: 'Course Name', data: 'courseId.name' },
            { title: 'Assignment Name', data: 'name' },
            { title: 'Teacher', data: 'courseId.teacher.name' },
            { 
                title: 'School Day', 
                data: 'schDay',
                render: function (data, type, row, meta) {
                    startDate = moment(row.courseId.startDate).format('DD/MM/YYYY');
                    endDate = moment(row.courseId.endDate).format('DD/MM/YYYY');
                    data = startDate + '-' + endDate;
                    return data
                },
            },
            { 
                title: 'Due Date', 
                data: 'dueDate',
                render: function (data, type, row, meta) {
                    return moment(data).format('DD/MM/YYYY');
                }
            },
            {
                title: 'Link',
                data: 'fileUrl',
                render: function (data, type, row, meta) {
                return `<a href="${data}" target="_blank" class="btn btn-outline-secondary btn-sm" >Link</a>`;
                },
            },
            {
                title: 'Marks',
                data: '_id',
                render: function (data, type, row, meta) {
                return `<a href="/assignments/mark/${data}" class="btn btn-secondary btn-sm">Mark assignment</a>`;
                },
            },
            { 
                title: 'Action', 
                data: '_id',
                render: function (data, type, row, meta) {
                    return `
                        <a href="/assignments/edit/${data}" class="btn btn-secondary btn-sm">Edit</a>
                        <button class="btn btn-danger btn-sm delete-assignment" data-id="${data}">Delete</button>
                        `;
                },
            },
            ],
        })

        $(document).on('click', '.delete-assignment', event => {
            if (confirm('Are you sure you want to delete this assignment?')) {
                const assignmentId = $(event.target).data('id')
                console.log(assignmentId)
                $.ajax({
                    url: `/api/assignments/${assignmentId}`,
                    method: 'DELETE',
                    success: response => {
                        if (response.success) {
                            location.reload()
                        } else {
                            alert('An error occurred: ' + response.message)
                        }
                    },
                    error: (xhr, status, error) => {
                        console.error('Error:', error)
                        alert('An error occurred. Please try again.')
                    },
                })
            }
        })
    })
</script>
<div class="container mt-4">
    <h2>Assignments List</h2>
    <a href="/assignments/add" class="btn btn-primary mb-3 admin hide">Add Assignment(s)</a>
    <table id="table" class="table table-striped table-bordered" ></table>
</div>
<%- contentFor('title') %>Assignments List
