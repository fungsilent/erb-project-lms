<div class="p-4">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/dashboard">Home</a></li>
        <li class="breadcrumb-item"><a href="/course">Assignment</a></li>
        <li class="breadcrumb-item active">Edit</li>
    </ol>
    <div class="card">
        <div class="card-body">
            <h4 class="card-title">Edit Assignment</h4>
            <form id="editAssignmentForm" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="assignmentName">Name:</label>
                    <input type="text" class="form-control" id="assignmentName" name="name" required>
                </div>
                <div class="form-group">
                    <label for="dueDate">Due Date:</label>
                    <input type="text" class="form-control due-date" id="dueDate" name="dueDate" required>
                </div>
                <div class="form-group">
                    <label for="totalMarks">Total Marks:</label>
                    <input type="number" class="form-control" id="totalMarks" name="totalMarks" required>
                </div>
                <div class="form-group">
                    <label for="passingMarks">Passing Marks:</label>
                    <input type="number" class="form-control" id="passingMarks" name="passingMarks" required>
                </div>
                <div class="form-group">
                    <label>Current File:</label>
                    <template id="viewFile">
                        <p>
                            <a href="${url}" target="_blank" class="btn btn-outline-secondary btn-sm">${filename}</a>
                        </p>
                    </template>
                </div>
                <div class="form-group">
                    <label for="assignmentFile">New Assignment File:</label>
                    <input type="file" class="form-control" id="assignmentFile" name="assignments">
                </div>
                <button type="submit" class="btn btn-primary mt-2">Save Changes</button>
            </form>
        </div>
    </div>
</div>

<script>
    $(document).ready(function() {
        const { id } = $.getUrlParameter('/assignments/edit/:id')
        
        $('.due-date').flatpickr({ dateFormat: 'Y-m-d' })

        axios.get(`/api/assignments/${id}/edit`).then(({ data: response }) => {
            console.log('response', response)
            if (!response.success) {
                return (`An error occurred: ${response.message}`)
            }
            const assignment = response.data
            $.setFormData('#editAssignmentForm', {
                ...assignment,
                dueDate: moment(assignment.dueDate).format('YYYY-MM-DD'),
            })
            const { filename } = $.getUrlParameter(assignment.fileUrl, '/uploads/:filename')
            $.cloneTemplate('#viewFile', {
                url: assignment.fileUrl,
                filename,
            })
        })

        $('#editAssignmentForm').on('submit', event => {
            event.preventDefault()
            axios.put(`/api/assignments/${id}`, new FormData(event.target)).then(response => {
                console.log('response', response)
                if (!response.success) {
                    return (`An error occurred: ${response.message}`)
                }
                window.location.href = '/assignments'
            })
        })
    })
</script>
<%- contentFor('title') %>Edit Assignment
